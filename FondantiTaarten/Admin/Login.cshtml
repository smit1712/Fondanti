@using WebMatrix.WebData;
@{   


    if (WebSecurity.Initialized == false)
    {

        WebSecurity.InitializeDatabaseConnection("FondantiDataBase", "Users", "UserId", "Username", true);
    }

    else
if (IsPost)
    {
        AntiForgery.Validate();
        string Username = Request["Username"];
        var Password = Request["Password"];

        Validation.RequireFields("Username", "Password");
        Validation.Add("Password", Validator.StringLength(16, 6));
        Validation.Add("Username", Validator.Regex(@"\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*", "Your username should be an email address"));

        var returnurl = Request["returnurl"];
        if (returnurl.IsEmpty())
        {
            returnurl = Href("~/Admin/AdminPage.cshtml");
        }


        if (Validation.IsValid())
        {


             if (WebSecurity.UserExists(Username) && WebSecurity.GetPasswordFailuresSinceLastSuccess(Username) >= 4 && WebSecurity.GetLastPasswordFailureDate(Username).AddMinutes(2) > DateTime.UtcNow)
            {
                Response.Redirect("~/account/AccountLockedOut");
            }

            if (WebSecurity.IsConfirmed(Username))
            {

                if (WebSecurity.Login(Username, Password))
                {
                    Context.RedirectLocal(returnurl);
                }
                else
                {
                    Validation.AddFormError("Incorrect username or password");
                }
            }
            else
            {
                Validation.AddFormError("User does not exist or account is not confirmed");
            }

        }

    }
    }

<!DOCTYPE html>
<html>
<head>
    <!-- Render Shared Header-->
    @RenderPage("~/_Shared/_Header.cshtml")
    <link rel="stylesheet" href="~/Admin/Login.css" />
</head>
<body>
    <!-- Render Shared Navbar-->
    @RenderPage("~/_Shared/_Navbar.cshtml")
    <div class="login-page">
    <div class="form">
    <form method="post" class="login-form">
        @AntiForgery.GetHtml()
        <fieldset>
            <legend>Login</legend>
            @Html.ValidationSummary(true)

            <div>
                <label>Username</label>
                <input type="text" name="Username" />
                @Html.ValidationMessage("Username")
            </div>

            <div>
                <label>Password</label>
                <input type="password" name="Password" />
                @Html.ValidationMessage("Password")
            </div>

            <button>Login</button>
        </fieldset>
    </form>
    
    </div>
        </div>
   </body>
</html>
